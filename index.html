<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>하하 패밀리를 지켜라!</title>
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: "Helvetica Neue", Arial, sans-serif; background:#f2f7ff; display:flex; justify-content:center; align-items:center; min-height:100vh; }
    #game-wrapper { width: 100%; max-width: 420px; background:white; border-radius:1rem; box-shadow:0 4px 12px rgba(0,0,0,.15); padding:1.5rem; display:flex; flex-direction:column; gap:1rem; }
    h1 { margin:0 0 .5rem 0; text-align:center; font-size:1.75rem; }
    #family-photo { width:100%; max-height:160px; object-fit:cover; border-radius:.5rem; }
    #house-status { text-align:center; font-size:1.4rem; }
    #question { text-align:center; font-size:1.3rem; margin:1rem 0; font-weight:600; }
    .options { display:grid; grid-template-columns:1fr 1fr; gap:.75rem; }
    .option-btn { padding:.75rem .5rem; background:#f0f4ff; border:none; border-radius:.75rem; font-size:1.05rem; cursor:pointer; transition:all .2s; }
    .option-btn:hover { transform:translateY(-2px); box-shadow:0 2px 6px rgba(0,0,0,.15); }
    .option-btn.correct { background:#d4f5cb; }
    .option-btn.wrong { background:#ffdedf; }
    #stage-info { text-align:center; font-size:.95rem; color:#333; }
    #start-screen, #end-screen { display:flex; flex-direction:column; gap:1rem; }
    #name-input { padding:.75rem 1rem; border:1px solid #ccc; border-radius:.75rem; font-size:1rem; }
    .primary-btn { padding:.75rem 1rem; background:#4b6bff; color:white; border:none; border-radius:.75rem; font-size:1.05rem; cursor:pointer; transition:background .2s; }
    .primary-btn:hover { background:#3958ff; }
    #scoreboard-table { width:100%; border-collapse:collapse; font-size:.9rem; }
    #scoreboard-table th, #scoreboard-table td { border:1px solid #ddd; padding:.35rem .5rem; text-align:center; }
    #scoreboard-table th { background:#eef3ff; }
  </style>
</head>
<body>
  <div id="game-wrapper">
    <h1>하하 패밀리를 지켜라!</h1>
    <img id="family-photo" src="family.jpg" alt="우리 가족" />

    <!-- Start Screen -->
    <div id="start-screen">
      <input id="name-input" type="text" placeholder="이름을 입력하세요" />
      <button id="start-btn" class="primary-btn">게임 시작</button>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" style="display:none;flex-direction:column;gap:1rem;">
      <div id="stage-info"></div>
      <div id="house-status"></div>
      <div id="question"></div>
      <div id="options" class="options"></div>
    </div>

    <!-- End Screen -->
    <div id="end-screen" style="display:none;flex-direction:column;gap:1rem;">
      <div id="final-msg" style="text-align:center;font-size:1.1rem;"></div>
      <button id="restart-btn" class="primary-btn">다시 하기</button>
      <h3 style="text-align:center;margin:0;">스코어 보드</h3>
      <table id="scoreboard-table"></table>
    </div>
  </div>

  <script>
    /*=============== 게임 데이터 ===============*/
    const STAGES = [
      // Stage 1
      [
        { en: "cat", ko: "고양이" }, { en: "dog", ko: "개" }, { en: "bird", ko: "새" }, { en: "fish", ko: "물고기" },
        { en: "ant", ko: "개미" }, { en: "bee", ko: "벌" }, { en: "pig", ko: "돼지" }, { en: "cow", ko: "소" },
        { en: "duck", ko: "오리" }, { en: "hen", ko: "암탉" }, { en: "egg", ko: "달걀" }, { en: "milk", ko: "우유" },
        { en: "book", ko: "책" }, { en: "pen", ko: "펜" }, { en: "bag", ko: "가방" }, { en: "bed", ko: "침대" },
        { en: "sun", ko: "해" }, { en: "moon", ko: "달" }, { en: "star", ko: "별" }, { en: "ball", ko: "공" }
      ],
      // Stage 2
      [
        { en: "mom", ko: "엄마" }, { en: "dad", ko: "아빠" }, { en: "brother", ko: "형" }, { en: "sister", ko: "누나" },
        { en: "baby", ko: "아기" }, { en: "grandpa", ko: "할아버지" }, { en: "grandma", ko: "할머니" }, { en: "hand", ko: "손" },
        { en: "foot", ko: "발" }, { en: "leg", ko: "다리" }, { en: "arm", ko: "팔" }, { en: "head", ko: "머리" },
        { en: "eye", ko: "눈" }, { en: "nose", ko: "코" }, { en: "mouth", ko: "입" }, { en: "ear", ko: "귀" },
        { en: "hair", ko: "머리카락" }, { en: "face", ko: "얼굴" }, { en: "tooth", ko: "이" }, { en: "finger", ko: "손가락" }
      ],
      // Stage 3
      [
        { en: "red", ko: "빨강" }, { en: "blue", ko: "파랑" }, { en: "green", ko: "초록" }, { en: "yellow", ko: "노랑" },
        { en: "orange", ko: "주황" }, { en: "purple", ko: "보라" }, { en: "pink", ko: "분홍" }, { en: "black", ko: "검정" },
        { en: "white", ko: "흰색" }, { en: "brown", ko: "갈색" }, { en: "one", ko: "하나" }, { en: "two", ko: "둘" },
        { en: "three", ko: "셋" }, { en: "four", ko: "넷" }, { en: "five", ko: "다섯" }, { en: "six", ko: "여섯" },
        { en: "seven", ko: "일곱" }, { en: "eight", ko: "여덟" }, { en: "nine", ko: "아홉" }, { en: "ten", ko: "열" }
      ],
      // Stage 4
      [
        { en: "rice", ko: "밥" }, { en: "bread", ko: "빵" }, { en: "soup", ko: "수프" }, { en: "meat", ko: "고기" },
        { en: "chicken", ko: "닭고기" }, { en: "apple", ko: "사과" }, { en: "banana", ko: "바나나" }, { en: "grape", ko: "포도" },
        { en: "orangefruit", ko: "오렌지" }, { en: "lemon", ko: "레몬" }, { en: "carrot", ko: "당근" }, { en: "potato", ko: "감자" },
        { en: "tomato", ko: "토마토" }, { en: "corn", ko: "옥수수" }, { en: "water", ko: "물" }, { en: "juice", ko: "주스" },
        { en: "tea", ko: "차" }, { en: "soda", ko: "탄산음료" }, { en: "sugar", ko: "설탕" }, { en: "salt", ko: "소금" }
      ],
      // Stage 5
      [
        { en: "school", ko: "학교" }, { en: "class", ko: "수업" }, { en: "teacher", ko: "선생님" }, { en: "student", ko: "학생" },
        { en: "desk", ko: "책상" }, { en: "chair", ko: "의자" }, { en: "pencil", ko: "연필" }, { en: "ruler", ko: "자" },
        { en: "eraser", ko: "지우개" }, { en: "paper", ko: "종이" }, { en: "notebook", ko: "공책" }, { en: "backpack", ko: "배낭" },
        { en: "clock", ko: "시계" }, { en: "door", ko: "문" }, { en: "window", ko: "창문" }, { en: "computer", ko: "컴퓨터" },
        { en: "marker", ko: "마커" }, { en: "board", ko: "칠판" }, { en: "bell", ko: "종" }, { en: "map", ko: "지도" }
      ],
      // Stage 6
      [
        { en: "go", ko: "가다" }, { en: "come", ko: "오다" }, { en: "see", ko: "보다" }, { en: "look", ko: "쳐다보다" },
        { en: "eat", ko: "먹다" }, { en: "drink", ko: "마시다" }, { en: "run", ko: "달리다" }, { en: "walk", ko: "걷다" },
        { en: "jump", ko: "뛰다" }, { en: "sit", ko: "앉다" }, { en: "stand", ko: "서다" }, { en: "read", ko: "읽다" },
        { en: "write", ko: "쓰다" }, { en: "play", ko: "놀다" }, { en: "sing", ko: "노래하다" }, { en: "dance", ko: "춤추다" },
        { en: "sleep", ko: "자다" }, { en: "smile", ko: "웃다" }, { en: "cry", ko: "울다" }, { en: "help", ko: "돕다" }
      ],
      // Stage 7
      [
        { en: "big", ko: "큰" }, { en: "small", ko: "작은" }, { en: "tall", ko: "키큰" }, { en: "short", ko: "키작은" },
        { en: "long", ko: "긴" }, { en: "fast", ko: "빠른" }, { en: "slow", ko: "느린" }, { en: "hot", ko: "뜨거운" },
        { en: "cold", ko: "차가운" }, { en: "warm", ko: "따뜻한" }, { en: "happy", ko: "행복한" }, { en: "sad", ko: "슬픈" },
        { en: "good", ko: "좋은" }, { en: "bad", ko: "나쁜" }, { en: "easy", ko: "쉬운" }, { en: "hard", ko: "어려운" },
        { en: "clean", ko: "깨끗한" }, { en: "dirty", ko: "더러운" }, { en: "new", ko: "새로운" }, { en: "old", ko: "낡은" }
      ],
      // Stage 8
      [
        { en: "home", ko: "집" }, { en: "park", ko: "공원" }, { en: "zoo", ko: "동물원" }, { en: "farm", ko: "농장" },
        { en: "bank", ko: "은행" }, { en: "hospital", ko: "병원" }, { en: "store", ko: "가게" }, { en: "market", ko: "시장" },
        { en: "church", ko: "교회" }, { en: "post", ko: "우체국" }, { en: "airport", ko: "공항" }, { en: "bus", ko: "버스정류장" },
        { en: "station", ko: "역" }, { en: "street", ko: "거리" }, { en: "road", ko: "도로" }, { en: "bridge", ko: "다리" },
        { en: "river", ko: "강" }, { en: "mountain", ko: "산" }, { en: "beach", ko: "해변" }, { en: "playground", ko: "놀이터" }
      ],
      // Stage 9
      [
        { en: "day", ko: "낮" }, { en: "night", ko: "밤" }, { en: "morning", ko: "아침" }, { en: "afternoon", ko: "오후" },
        { en: "evening", ko: "저녁" }, { en: "today", ko: "오늘" }, { en: "tomorrow", ko: "내일" }, { en: "yesterday", ko: "어제" },
        { en: "week", ko: "주" }, { en: "month", ko: "달" }, { en: "year", ko: "년" }, { en: "spring", ko: "봄" },
        { en: "summer", ko: "여름" }, { en: "autumn", ko: "가을" }, { en: "winter", ko: "겨울" }, { en: "sunny", ko: "맑은" },
        { en: "rainy", ko: "비오는" }, { en: "cloudy", ko: "흐린" }, { en: "snowy", ko: "눈오는" }, { en: "windy", ko: "바람부는" }
      ],
      // Stage 10
      [
        { en: "phone", ko: "전화기" }, { en: "toy", ko: "장난감" }, { en: "picture", ko: "그림" }, { en: "key", ko: "열쇠" },
        { en: "box", ko: "상자" }, { en: "gift", ko: "선물" }, { en: "money", ko: "돈" }, { en: "card", ko: "카드" },
        { en: "ticket", ko: "티켓" }, { en: "music", ko: "음악" }, { en: "movie", ko: "영화" }, { en: "game", ko: "게임" },
        { en: "idea", ko: "아이디어" }, { en: "love", ko: "사랑" }, { en: "ride", ko: "타다" }, { en: "open", ko: "열다" },
        { en: "close", ko: "닫다" }, { en: "wait", ko: "기다리다" }, { en: "think", ko: "생각하다" }, { en: "learn", ko: "배우다" }
      ]
    ];

    const DARK_POKEMON = [
      "Umbreon", "Darkrai", "Absol", "Hydreigon", "Tyranitar", "Zoroark", "Weavile", "Honchkrow", "Yveltal", "Incineroar"
    ];

    /*=============== 전역 변수 ===============*/
    let playerName = "";
    let stageIdx = 0;
    let lives = 5;
    let correctThisStage = 0;

    /*=============== 유틸리티 함수 ===============*/
    const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);
    const $(id) => document.querySelector(id);

    /*=============== DOM 요소 ===============*/
    const startScreen = document.getElementById("start-screen");
    const gameScreen = document.getElementById("game-screen");
    const endScreen = document.getElementById("end-screen");
    const nameInput = document.getElementById("name-input");
    const startBtn = document.getElementById("start-btn");
    const restartBtn = document.getElementById("restart-btn");

    const stageInfoEl = document.getElementById("stage-info");
    const houseStatusEl = document.getElementById("house-status");
    const questionEl = document.getElementById("question");
    const optionsEl = document.getElementById("options");

    const finalMsgEl = document.getElementById("final-msg");
    const scoreboardTable = document.getElementById("scoreboard-table");

    /*=============== 게임 로직 ===============*/
    let currentWords = [];
    let currentWordIdx = 0;

    function startGame() {
      playerName = nameInput.value.trim() || "Player";
      stageIdx = 0;
      loadStage();
      startScreen.style.display = "none";
      endScreen.style.display = "none";
      gameScreen.style.display = "flex";
    }

    function loadStage() {
      lives = 5;
      correctThisStage = 0;
      currentWords = shuffle([...STAGES[stageIdx]]);
      currentWordIdx = 0;
      updateHouse();
      stageInfoEl.textContent = `단계 ${stageIdx + 1} / 10`;
      nextQuestion();
    }

    function nextQuestion() {
      if (correctThisStage === 20) {
        // Stage clear
        stageIdx++;
        if (stageIdx >= STAGES.length) {
          // Game clear!
          finishGame(true);
          return;
        }
        loadStage();
        return;
      }

      const word = currentWords[currentWordIdx];
      questionEl.textContent = `"${word.en}" 의 뜻은?`;

      // 만들 보기
      let choices = [word.ko];
      while (choices.length < 4) {
        const randStage = STAGES[Math.floor(Math.random() * STAGES.length)];
        const randWord = randStage[Math.floor(Math.random() * randStage.length)];
        if (!choices.includes(randWord.ko)) choices.push(randWord.ko);
      }
      shuffle(choices);

      // 렌더 보기
      optionsEl.innerHTML = "";
      choices.forEach((choice) => {
        const btn = document.createElement("button");
        btn.textContent = choice;
        btn.className = "option-btn";
        btn.onclick = () => handleChoice(btn, choice === word.ko);
        optionsEl.appendChild(btn);
      });
    }

    function handleChoice(btn, isCorrect) {
      Array.from(optionsEl.children).forEach((b) => (b.disabled = true));
      if (isCorrect) {
        btn.classList.add("correct");
        correctThisStage++;
        currentWordIdx = (currentWordIdx + 1) % currentWords.length;
        setTimeout(nextQuestion, 800);
      } else {
        btn.classList.add("wrong");
        lives--;
        houseStatusEl.textContent += `\n${randomPokemon()} 의 공격!`;
        updateHouse();
        if (lives === 0) {
          finishGame(false);
        } else {
          setTimeout(nextQuestion, 1000);
        }
      }
    }

    function updateHouse() {
      const full = "🏠".repeat(lives);
      const broken = "💥".repeat(5 - lives);
      houseStatusEl.textContent = full + broken;
    }

    function randomPokemon() {
      return DARK_POKEMON[Math.floor(Math.random() * DARK_POKEMON.length)];
    }

    function finishGame(cleared) {
      gameScreen.style.display = "none";
      endScreen.style.display = "flex";
      const resultText = cleared
        ? `${playerName} 님, 축하합니다! 10단계를 모두 지켜냈어요!`
        : `${playerName} 님, 단계 ${stageIdx + 1}에서 무너졌어요... (맞춘 단어 ${correctThisStage}/20)`;
      finalMsgEl.textContent = resultText;
      saveScore(playerName, stageIdx + 1, correctThisStage);
      renderScoreboard();
    }

    /*=============== 스코어 보드 ===============*/
    function getScores() {
      return JSON.parse(localStorage.getItem("hahaScores") || "[]");
    }
    function saveScore(name, stage, correct) {
      const scores = getScores();
      scores.push({ name, stage, correct, date: Date.now() });
      localStorage.setItem("hahaScores", JSON.stringify(scores.slice(-20))); // 최근 20개만 저장
    }
    function renderScoreboard() {
      const scores = getScores().sort((a,b)=>b.date - a.date);
      scoreboardTable.innerHTML = "<tr><th>이름</th><th>단계</th><th>맞춘 단어수</th></tr>" +
        scores.map(s => `<tr><td>${s.name}</td><td>${s.stage}</td><td>${s.correct}</td></tr>`).join("");
    }

    /*=============== 이벤트 바인딩 ===============*/
    startBtn.addEventListener("click", startGame);
    restartBtn.addEventListener("click", () => {
      startScreen.style.display = "flex";
      endScreen.style.display = "none";
    });
  </script>
</body>
</html>
